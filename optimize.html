<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图片优化 | 前端面试题</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/Front-end-interview/assets/css/0.styles.8848344e.css" as="style"><link rel="preload" href="/Front-end-interview/assets/js/app.fdae9a04.js" as="script"><link rel="preload" href="/Front-end-interview/assets/js/2.2ef4b7ab.js" as="script"><link rel="preload" href="/Front-end-interview/assets/js/12.8bc73bd9.js" as="script"><link rel="prefetch" href="/Front-end-interview/assets/js/10.1936cde4.js"><link rel="prefetch" href="/Front-end-interview/assets/js/11.eb007c06.js"><link rel="prefetch" href="/Front-end-interview/assets/js/13.5b5be3d4.js"><link rel="prefetch" href="/Front-end-interview/assets/js/14.dd28f4e2.js"><link rel="prefetch" href="/Front-end-interview/assets/js/15.67908718.js"><link rel="prefetch" href="/Front-end-interview/assets/js/16.2b6e8ce7.js"><link rel="prefetch" href="/Front-end-interview/assets/js/17.c0560b94.js"><link rel="prefetch" href="/Front-end-interview/assets/js/18.879f6c33.js"><link rel="prefetch" href="/Front-end-interview/assets/js/19.35ca9314.js"><link rel="prefetch" href="/Front-end-interview/assets/js/20.8da81083.js"><link rel="prefetch" href="/Front-end-interview/assets/js/21.9c5e2e4f.js"><link rel="prefetch" href="/Front-end-interview/assets/js/22.79ace77f.js"><link rel="prefetch" href="/Front-end-interview/assets/js/3.895fa97e.js"><link rel="prefetch" href="/Front-end-interview/assets/js/4.99bb1ea4.js"><link rel="prefetch" href="/Front-end-interview/assets/js/5.c7ab20ec.js"><link rel="prefetch" href="/Front-end-interview/assets/js/6.b688de92.js"><link rel="prefetch" href="/Front-end-interview/assets/js/7.c4e3305b.js"><link rel="prefetch" href="/Front-end-interview/assets/js/8.083d3bab.js"><link rel="prefetch" href="/Front-end-interview/assets/js/9.97deec76.js">
    <link rel="stylesheet" href="/Front-end-interview/assets/css/0.styles.8848344e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Front-end-interview/" class="home-link router-link-active"><!----> <span class="site-name">前端面试题</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/Front-end-interview/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/Front-end-interview/js.html" class="sidebar-link">JavaScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#javascript-里的最大安全数是多少-为什么" class="sidebar-link">javascript 里的最大安全数是多少，为什么</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#为什么-0-1-0-2-与-0-3-不相等-如何解决" class="sidebar-link">为什么 0.1 + 0.2 与 0.3 不相等，如何解决</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#小数四舍五入问题" class="sidebar-link">小数四舍五入问题</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#commonjs-和-es6-的区别" class="sidebar-link">commonjs 和 es6 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#什么是循环依赖" class="sidebar-link">什么是循环依赖？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#session、cookie、token-和-jwt-的区别" class="sidebar-link">session、cookie、token 和 jwt 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#dom-事件触发流程" class="sidebar-link">DOM 事件触发流程</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#target-和-currenttarget-区别" class="sidebar-link">target 和 currentTarget 区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#什么是事件委托" class="sidebar-link">什么是事件委托</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#prototype-和-proto-的关系是什么" class="sidebar-link">prototype 和 __proto__ 的关系是什么</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#原型链" class="sidebar-link">原型链</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#内存回收" class="sidebar-link">内存回收</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#对象浅拷贝和深拷贝有什么区别" class="sidebar-link">对象浅拷贝和深拷贝有什么区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#javascript-里的类型判断" class="sidebar-link">javascript 里的类型判断</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#javascript-有哪些数据类型" class="sidebar-link">javascript 有哪些数据类型</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#内置对象和函数" class="sidebar-link">内置对象和函数</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#cookie、localstorage、sessionstorage区别" class="sidebar-link">cookie、localStorage、sessionStorage区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#请简述-javascript-中的-this" class="sidebar-link">请简述 JavaScript 中的 this</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#window-onload-和-domcontentloaded-的区别" class="sidebar-link">window.onload 和 DOMContentLoaded 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#object-与-map-的区别" class="sidebar-link">Object 与 Map 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#为什么-weakmap-和-weakset-的键只能使用对象" class="sidebar-link">为什么 WeakMap 和 WeakSet 的键只能使用对象？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#javascript-事件循环" class="sidebar-link">javascript 事件循环</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#图解-dom-位置关系" class="sidebar-link">图解 DOM 位置关系</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#常见的位运算符有哪些-其计算规则是什么" class="sidebar-link">常见的位运算符有哪些？其计算规则是什么？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#escape-encodeuri-encodeuricomponent-的区别" class="sidebar-link">escape，encodeURI，encodeURIComponent 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#对象的遍历顺序" class="sidebar-link">对象的遍历顺序</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/js.html#iterator-和-for-of-循环" class="sidebar-link">Iterator 和 for...of 循环</a></li></ul></li><li><a href="/Front-end-interview/implement.html" class="sidebar-link">手写和实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#async-和-generator-的关系-如何使用-generator-实现-async" class="sidebar-link">async 和 Generator 的关系，如何使用 Generator 实现 async</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#实现-compose-函数" class="sidebar-link">实现 compose 函数</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#实现-new-操作符" class="sidebar-link">实现 new 操作符</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#使用-es5-和-es6-实现继承" class="sidebar-link">使用 ES5 和 ES6 实现继承</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#实现发布-订阅模式" class="sidebar-link">实现发布/订阅模式</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#如何实现一个可设置过期时间的-localstorage" class="sidebar-link">如何实现一个可设置过期时间的 localStorage</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#防抖和节流函数的原理和实现" class="sidebar-link">防抖和节流函数的原理和实现</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#函数柯里化的优点和实现" class="sidebar-link">函数柯里化的优点和实现</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#简易-promise-的实现" class="sidebar-link">简易 Promise 的实现</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/implement.html#promise-all-和-promise-allsettled-的实现" class="sidebar-link">Promise.All 和 Promise.AllSettled 的实现</a></li></ul></li><li><a href="/Front-end-interview/typescript.html" class="sidebar-link">TypeScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/typescript.html#type-和-interface-的相同点和不同点" class="sidebar-link">type 和 interface 的相同点和不同点</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/typescript.html#infer-的协变和逆变" class="sidebar-link">infer 的协变和逆变</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/typescript.html#设计一个泛型-接受一个对象类型-返回一个可选的-key-的对象类型-但不能是空对象" class="sidebar-link">设计一个泛型，接受一个对象类型，返回一个可选的 key 的对象类型，但不能是空对象</a></li></ul></li><li><a href="/Front-end-interview/css.html" class="sidebar-link">CSS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#bem-命名规范" class="sidebar-link">BEM 命名规范</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#padding-top-和-margin-top-的百分比相对于什么-为什么" class="sidebar-link">padding-top 和 margin-top 的百分比相对于什么，为什么</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#文字和图片并排居中" class="sidebar-link">文字和图片并排居中</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#文本超出部分显示省略号" class="sidebar-link">文本超出部分显示省略号</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#什么是-bfc" class="sidebar-link">什么是 BFC</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#css-作用域隔离方法" class="sidebar-link">css 作用域隔离方法</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#聊聊伪类和伪元素-伪对象" class="sidebar-link">聊聊伪类和伪元素（伪对象）</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#flex-属性的默认值" class="sidebar-link">flex 属性的默认值</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#fixed-元素相对于什么定位" class="sidebar-link">fixed 元素相对于什么定位</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#有没有遇到过-z-index-小的反而在上层的情况" class="sidebar-link">有没有遇到过 z-index 小的反而在上层的情况？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/css.html#width-100-与-width-auto-的区别" class="sidebar-link">width:100% 与 width:auto 的区别</a></li></ul></li><li><a href="/Front-end-interview/html.html" class="sidebar-link">HTML</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/html.html#html5语义化" class="sidebar-link">HTML5语义化</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/html.html#viewport" class="sidebar-link">viewport</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/html.html#src-和-href-的区别" class="sidebar-link">src 和 href 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/html.html#defer-和-async-的区别" class="sidebar-link">defer 和 async 的区别</a></li></ul></li><li><a href="/Front-end-interview/vue.html" class="sidebar-link">Vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-的生命周期有哪些" class="sidebar-link">Vue 的生命周期有哪些</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-响应式原理" class="sidebar-link">Vue 响应式原理</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue3-和-vue2-的区别" class="sidebar-link">Vue3 和 Vue2 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-和-react-的区别是什么" class="sidebar-link">Vue 和 React 的区别是什么</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-父子组件生命周期执行顺序" class="sidebar-link">Vue 父子组件生命周期执行顺序</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-router原理" class="sidebar-link">Vue-router原理</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vuex原理" class="sidebar-link">Vuex原理</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-中的-key-的作用" class="sidebar-link">Vue 中的 key 的作用</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#virtual-dom-的优势在哪里" class="sidebar-link">Virtual Dom 的优势在哪里</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue1-中的-documentfragement-有什么作用" class="sidebar-link">Vue1 中的 DocumentFragement 有什么作用</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-子组件-emit-后-props-会立刻更新吗-为什么" class="sidebar-link">Vue 子组件 $emit 后 props 会立刻更新吗？为什么</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-源码里的设计模式有哪些" class="sidebar-link">Vue 源码里的设计模式有哪些</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-虚拟-dom-diff-算法" class="sidebar-link">Vue 虚拟 DOM diff 算法</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue2-和-vue3-diff-算法的区别" class="sidebar-link">Vue2 和 Vue3 diff 算法的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/vue.html#vue-和-react-diff-算法的区别" class="sidebar-link">Vue 和 React diff 算法的区别</a></li></ul></li><li><a href="/Front-end-interview/react.html" class="sidebar-link">React</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/react.html#hooks-的出现解决了什么问题" class="sidebar-link">hooks 的出现解决了什么问题？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/react.html#react-的生命周期有哪些" class="sidebar-link">React 的生命周期有哪些？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/react.html#purecomponent-和-component-区别" class="sidebar-link">PureComponent 和 Component 区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/react.html#如何使用-context-上下文" class="sidebar-link">如何使用 Context 上下文</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/react.html#react-父组件调用子组件的方法" class="sidebar-link">React 父组件调用子组件的方法</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/react.html#react-组件更新流程" class="sidebar-link">React 组件更新流程</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/react.html#react-虚拟-dom-diff-算法" class="sidebar-link">React 虚拟 DOM diff 算法</a></li></ul></li><li><a href="/Front-end-interview/engineering.html" class="sidebar-link">工程化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#webpack-loader-的加载顺序" class="sidebar-link">webpack Loader 的加载顺序</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#webpack-中-hash、chunkhash、contenthash-有什么不同" class="sidebar-link">webpack 中 hash、chunkhash、contenthash 有什么不同？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#聊聊-webpack-的-tree-shaking" class="sidebar-link">聊聊 webpack 的 tree-shaking</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#webpack-的-sideeffects-字段应该怎么用" class="sidebar-link">webpack 的 sideEffects 字段应该怎么用</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#实现一个-webpack-loader-和-webpack-plugin" class="sidebar-link">实现一个 webpack loader 和 webpack plugin</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#webpack-打包后代码里的-esmodule-和-pure-是用来干嘛的" class="sidebar-link">webpack 打包后代码里的 __esModule 和 __PURE__ 是用来干嘛的</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#webpack-splitchunks-如何使用" class="sidebar-link">webpack splitChunks 如何使用</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/engineering.html#es6-的-async-await-编译为-es5-是什么样子" class="sidebar-link">ES6 的 async await 编译为 ES5 是什么样子</a></li></ul></li><li><a href="/Front-end-interview/browser.html" class="sidebar-link">浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/browser.html#什么是同源政策有哪些限制" class="sidebar-link">什么是同源政策有哪些限制</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/browser.html#为什么浏览器的-js-线程和-ui-线程是互斥的" class="sidebar-link">为什么浏览器的 JS 线程和 UI 线程是互斥的？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/browser.html#跨域资源共享-cors" class="sidebar-link">跨域资源共享（CORS）</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/browser.html#在浏览器输入-url-回车之后发生了什么" class="sidebar-link">在浏览器输入 URL 回车之后发生了什么</a></li></ul></li><li><a href="/Front-end-interview/http.html" class="sidebar-link">HTTP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/http.html#get-post-请求有什么区别" class="sidebar-link">GET/POST 请求有什么区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/http.html#一个-tcp-连接能发几个-http-请求" class="sidebar-link">一个 TCP 连接能发几个 HTTP 请求?</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/http.html#http-缓存" class="sidebar-link">HTTP 缓存</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/http.html#keep-alive-和多路复用的区别" class="sidebar-link">keep-alive 和多路复用的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/http.html#http-状态码" class="sidebar-link">HTTP 状态码</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/http.html#https加密过程详解" class="sidebar-link">HTTPS加密过程详解</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/http.html#域名解析流程" class="sidebar-link">域名解析流程</a></li></ul></li><li><a href="/Front-end-interview/node.html" class="sidebar-link">Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/node.html#package-json-依赖项版本号前面的-有什么用" class="sidebar-link">package.json 依赖项版本号前面的 ~ ^ 有什么用？</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/node.html#项目中使用-package-lock-json-锁版本问题" class="sidebar-link">项目中使用 package-lock.json 锁版本问题</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/node.html#peerdependencies-有什么用" class="sidebar-link">peerDependencies 有什么用</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/node.html#require-原理" class="sidebar-link">require 原理</a></li></ul></li><li><a href="/Front-end-interview/arithmetic.html" class="sidebar-link">算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/arithmetic.html#手写冒泡算法" class="sidebar-link">手写冒泡算法</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/arithmetic.html#根据-value-获取叶子节点" class="sidebar-link">根据 value 获取叶子节点</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/arithmetic.html#根据-value-获取叶子节点的路径" class="sidebar-link">根据 value 获取叶子节点的路径</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/arithmetic.html#列表结构转树结构" class="sidebar-link">列表结构转树结构</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/arithmetic.html#实现洗牌算法" class="sidebar-link">实现洗牌算法</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/arithmetic.html#二叉树遍历-前序、中序、后序、广度优先" class="sidebar-link">二叉树遍历(前序、中序、后序、广度优先)</a></li></ul></li><li><a href="/Front-end-interview/safe.html" class="sidebar-link">前端安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/safe.html#什么是-xss" class="sidebar-link">什么是 XSS</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/safe.html#什么是-csrf" class="sidebar-link">什么是 CSRF</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/safe.html#什么是-csp" class="sidebar-link">什么是 CSP</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/safe.html#cookie-的保护方式" class="sidebar-link">Cookie 的保护方式</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/safe.html#常见的编码和加密算法" class="sidebar-link">常见的编码和加密算法</a></li></ul></li><li><a href="/Front-end-interview/optimize.html" aria-current="page" class="active sidebar-link">前端优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#图片优化" class="sidebar-link">图片优化</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#http请求" class="sidebar-link">HTTP请求</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#webpack-的优化" class="sidebar-link">webpack 的优化</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#使用-cdn-加载静态资源" class="sidebar-link">使用 CDN 加载静态资源</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#合理放置-css-和-js-的位置" class="sidebar-link">合理放置 CSS 和 JS 的位置</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#使用缓存" class="sidebar-link">使用缓存</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#减少重绘和重排" class="sidebar-link">减少重绘和重排</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#使用事件委托" class="sidebar-link">使用事件委托</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#大量计算使用-web-workers" class="sidebar-link">大量计算使用 Web Workers</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#dns-prefetch-和-preconnect" class="sidebar-link">DNS-prefetch 和 Preconnect</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#preload-和-prefetch" class="sidebar-link">preload 和 prefetch</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#开启-gzip-压缩" class="sidebar-link">开启 gzip 压缩</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#vue-优化" class="sidebar-link">Vue 优化</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#react-优化" class="sidebar-link">React 优化</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#hybrid-app-下的性能优化" class="sidebar-link">Hybrid App 下的性能优化</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/optimize.html#首屏渲染白屏时间如何优化" class="sidebar-link">首屏渲染白屏时间如何优化</a></li></ul></li><li><a href="/Front-end-interview/other.html" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#单点登录" class="sidebar-link">单点登录</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#正则表达式" class="sidebar-link">正则表达式</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#ascii、gbk、utf、unicode" class="sidebar-link">Ascii、GBK、UTF、Unicode</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#git-merge-和-git-rebase区别" class="sidebar-link">git merge 和 git rebase区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#为什么引用值要放在堆中-而原始值要放在栈中" class="sidebar-link">为什么引用值要放在堆中，而原始值要放在栈中</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#nginx-常见配置" class="sidebar-link">Nginx 常见配置</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#mvc、mcp、mvvm-的区别" class="sidebar-link">MVC、MCP、MVVM 的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#观察者模式和发布订阅模式的区别" class="sidebar-link">观察者模式和发布订阅模式的区别</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#常见的缓存淘汰算法有哪些" class="sidebar-link">常见的缓存淘汰算法有哪些</a></li><li class="sidebar-sub-header"><a href="/Front-end-interview/other.html#依赖注入中如何解决循环依赖" class="sidebar-link">依赖注入中如何解决循环依赖</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="图片优化"><a href="#图片优化" class="header-anchor">#</a> 图片优化</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <h4 id="有损压缩"><a href="#有损压缩" class="header-anchor">#</a> 有损压缩</h4> <p>指在压缩文件大小的过程中，损失了一部分图片的信息，也即降低了图片的质量，并且这种损失是不可逆的，我们不可能从有一个有损压缩过的图片中恢复出全来的图片。常见的有损压缩手段，是按照一定的算法将临近的像素点进行合并。</p> <h4 id="无损压缩"><a href="#无损压缩" class="header-anchor">#</a> 无损压缩</h4> <p>只在压缩文件大小的过程中，图片的质量没有任何损耗。我们任何时候都可以从无损压缩过的图片中恢复出原来的信息。</p> <h4 id="索引色"><a href="#索引色" class="header-anchor">#</a> 索引色</h4> <p>用一个数字来代表（索引）一种颜色，在存储图片的时候，存储一个数字的组合，同时存储数字到图片颜色的映射。这种方式只能存储有限种颜色，通常是256种颜色，对应到计算机系统中，使用一个字节的数字来索引一种颜色。</p> <h4 id="直接色"><a href="#直接色" class="header-anchor">#</a> 直接色</h4> <p>使用四个数字来代表一种颜色，这四个数字分别代表这个颜色中红色、绿色、蓝色以及透明度。现在流行的显示设备可以在这四个维度分别支持256种变化，所以直接色可以表示2的32次方种颜色。当然并非所有的直接色都支持这么多种，为压缩空间使用，有可能只有表达红、绿、蓝的三个数字，每个数字也可能不支持256种变化之多。</p> <h4 id="点阵-位-图"><a href="#点阵-位-图" class="header-anchor">#</a> 点阵（位）图</h4> <p>点阵图是由象素的排列来实现其显示效果的，每个象素有自己的颜色信息，在对点阵图进行编辑操作的时候，可操作的对象是每个象素，我们可以改变图像的色相、饱和度、明度，从而改变图像的显示效果。点阵图缩放会失真，用最近非常流行的沙画来比喻最恰当不过，当你从远处看的时候，画面细腻多彩，但是当你靠的非常近的时候，你就能看到组成画面的每粒沙子以及每个沙粒的颜色。</p> <h4 id="矢量图"><a href="#矢量图" class="header-anchor">#</a> 矢量图</h4> <p>也叫做向量图。矢量图并不纪录画面上每一点的信息，而是纪录了元素形状及颜色的算法，当你打开一付矢量图的时候，软件对图形象对应的函数进行运算，将运算结果（图形的形状和颜色）显示给你看。无论显示画面是大还是小，画面上的对象对应的算法是不变的，所以，即使对画面进行倍数相当大的缩放，其显示效果仍然相同(不失真)。</p> <h3 id="常见图片格式和使用场景"><a href="#常见图片格式和使用场景" class="header-anchor">#</a> 常见图片格式和使用场景</h3> <h4 id="bmp"><a href="#bmp" class="header-anchor">#</a> BMP</h4> <p>BMP，是无损的、既支持索引色也支持直接色的点阵图。这种图片格式几乎没有对数据进行压缩，所以BMP格式的图片通常是较大的文件。</p> <h4 id="gif"><a href="#gif" class="header-anchor">#</a> GIF</h4> <p>GIF 是无损的、采用索引色的点阵图。采用 LZW 压缩算法进行编码。文件小，是 GIF 格式的优点，同时，GIF 格式还具有支持动画以及透明的优点。但是 GIF 格式仅支持 8bit 的索引色，所以 GIF 格式适用于对色彩要求不高同时需要文件体积较小的场景。</p> <h4 id="jpeg"><a href="#jpeg" class="header-anchor">#</a> JPEG</h4> <p>JPEG 是有损的、采用直接色的点阵图。JPEG 的图片的优点是采用了直接色，得益于更丰富的色彩，JPEG 非常适合用来存储照片，与 GIF 相比，JPEG 不适合用来存储企业 Logo、线框类的图。因为有损压缩会导致图片模糊，而直接色的选用，又会导致图片文件较 GIF 更大。</p> <h4 id="png-8"><a href="#png-8" class="header-anchor">#</a> PNG-8</h4> <p>PNG-8 是无损的、使用索引色的点阵图。PNG 是一种比较新的图片格式，PNG-8 是非常好的 GIF 格式替代者，在可能的情况下，应该尽可能的使用 PNG-8 而不是 GIF，因为在相同的图片效果下，PNG-8 具有更小的文件体积。除此之外，PNG-8 还支持透明度的调节，而 GIF 并不支持。除非需要动画的支持，否则没有理由使用 GIF 而不是 PNG-8。</p> <h4 id="png-24"><a href="#png-24" class="header-anchor">#</a> PNG-24</h4> <p>PNG-24 是无损的、使用直接色的点阵图。PNG-24 的优点在于它压缩了图片的数据，使得同样效果的图片，PNG-24 格式的文件大小要比 BMP 小得多。不过 PNG24 的图片还是要比 JPEG、GIF、PNG-8 大得多。</p> <h4 id="svg"><a href="#svg" class="header-anchor">#</a> SVG</h4> <p>SVG 是无损的矢量图。SVG 是矢量图意味着 SVG 图片由直线和曲线以及绘制它们的方法组成。当放大 SVG 图片时，看到的还是线和曲线，而不会出现像素点。这意味着 SVG 图片在放大时，不会失真，所以它非常适合用来绘制 Logo、Icon 等。</p> <h4 id="webp"><a href="#webp" class="header-anchor">#</a> WebP</h4> <p>WebP 是谷歌开发的一种新图片格式，WebP 是同时支持有损和无损压缩的、使用直接色的点阵图。从名字就可以看出来它是为 Web 而生的，什么叫为 Web 而生呢？就是说相同质量的图片，WebP 具有更小的文件体积。现在网站上充满了大量的图片，如果能够降低每一个图片的文件大小，那么将大大减少浏览器和服务器之间的数据传输量，进而降低访问延迟，提升访问体验。目前只有 Chrome 浏览器和 Opera 浏览器支持 WebP 格式，兼容性不太好。另外 WebP 格式的图片无法直接在 mac 上双击预览，需要安装相对应的插件，增加了使用成本。</p> <h3 id="如何对项目上的图片进行优化"><a href="#如何对项目上的图片进行优化" class="header-anchor">#</a> 如何对项目上的图片进行优化？</h3> <ol><li>不用图片。很多时候会使用到很多修饰类图片，其实这类修饰图片完全可以用 CSS 去代替，或者图标字体 iconfont 去代替。</li> <li>对于移动端来说，屏幕宽度就那么点，往往使用图片的某一部分，这个时候可以提前裁剪图片，请求裁剪好的小图。</li> <li>小图使用 base64 格式，减少 http 请求。</li> <li>将多个图标文件整合到一张图片中（雪碧图），减少 http 请求。</li> <li>选取正确的图片格式，在兼容性允许的情况下尽量使用 WebP 格式的图片。小图使用 PNG 或者 SVG 图片，照片使用 JPEG 格式。</li> <li>必要的时候使用图片懒加载。</li></ol> <h2 id="http请求"><a href="#http请求" class="header-anchor">#</a> HTTP请求</h2> <p>浏览器对同域的请求是有并发限制的，一般是 6 个，同一个域名并发请求多个资源往往会导致阻塞，可以使用以下方法：</p> <ol><li>减少 HTTP 请求<br>
一个完整的 HTTP 请求需要经历 DNS 查找，TCP 握手，浏览器发出 HTTP 请求，服务器接收请求，服务器处理请求并发回响应，浏览器接收响应等过程。在文件很小的情况下发送请求是很不划算的，此时我们可以减少发送的请求来提升相应的速度，例如将小图片改成 base64 格式，合并请求等。</li> <li>使用 HTTP/2.0<br>
HTTP/2.0 版本协议，支持多路复用，理论上 HTTP/2.0 协议支持在同一个 TCP 连接上发送无限个 HTTP 请求，且这些请求的生命期可以重叠，大大减少请求时间，在使用 HTTP/2.0 后小图就没必要使用 base64 了。</li> <li>域名划分
通过将资源划分到不同的域名下，增加请求并行连接数。</li></ol> <h2 id="webpack-的优化"><a href="#webpack-的优化" class="header-anchor">#</a> webpack 的优化</h2> <ol><li>压缩代码</li> <li>使用 contenthash 作为文件名称的一部分，利于浏览器缓存</li> <li>tree-shaking</li> <li>分割代码，将第三方插件或公共代码单独提取出来打包</li> <li>异步模块，按需加载（例如 Vue 路由懒加载）</li></ol> <h2 id="使用-cdn-加载静态资源"><a href="#使用-cdn-加载静态资源" class="header-anchor">#</a> 使用 CDN 加载静态资源</h2> <p>内容分发网络（CDN）是一组分布在多个不同地理位置的 Web 服务器。我们都知道，当服务器离用户越远时，延迟越高。CDN 就是为了解决这一问题，在多个位置部署服务器，让用户离服务器更近，从而缩短请求时间。</p> <h3 id="cdn-原理"><a href="#cdn-原理" class="header-anchor">#</a> CDN 原理</h3> <p>当用户访问一个网站时，如果没有 CDN，过程是这样的：</p> <ol><li>浏览器要将域名解析为 IP 地址，所以需要向本地 DNS 发出请求。</li> <li>本地 DNS 依次向根服务器、顶级域名服务器、权限服务器发出请求，得到网站服务器的 IP 地址。</li> <li>本地 DNS 将 IP 地址发回给浏览器，浏览器向网站服务器 IP 地址发出请求并得到资源。
<img src="/Front-end-interview/assets/img/cdn_1.75212642.jpg" alt=""></li></ol> <p>如果用户访问的网站部署了 CDN，过程是这样的：</p> <ol><li>浏览器要将域名解析为 IP 地址，所以需要向本地 DNS 发出请求。</li> <li>本地 DNS 依次向根服务器、顶级域名服务器、权限服务器发出请求，得到全局负载均衡系统（GSLB）的 IP 地址。</li> <li>本地 DNS 再向 GSLB 发出请求，GSLB 的主要功能是根据本地 DNS 的 IP 地址判断用户的位置，筛选出距离用户较近的本地负载均衡系统（SLB），并将该 SLB 的 IP 地址作为结果返回给本地 DNS。</li> <li>本地 DNS 将 SLB 的 IP 地址发回给浏览器，浏览器向 SLB 发出请求。</li> <li>SLB 根据浏览器请求的资源和地址，选出最优的缓存服务器发回给浏览器。</li> <li>浏览器再根据 SLB 发回的地址重定向到缓存服务器。</li> <li>如果缓存服务器有浏览器需要的资源，就将资源发回给浏览器。如果没有，就向源服务器请求资源，再发给浏览器并缓存在本地。
<img src="/Front-end-interview/assets/img/cdn_2.4f313b50.jpg" alt=""></li></ol> <h2 id="合理放置-css-和-js-的位置"><a href="#合理放置-css-和-js-的位置" class="header-anchor">#</a> 合理放置 CSS 和 JS 的位置</h2> <ol><li>CSS 放在文件头部<br>
CSS 的加载不会阻塞 DOM 树的解析，但是会阻塞 DOM 树的渲染，也会阻塞 JS 的执行。我们将 CSS 放置在头部可以防止用户先看到没有样式的“丑陋”的页面，同时也可以尽快渲染出页面，呈现给用户。</li> <li>将 JS 放置到文件底部或加上 defer 属性<br>
JS 的执行会阻塞 DOM 树的解析，将 JS 放置到文件底部，等 HTML 和 CSS 解析完了再加载 JS 文件，可以尽早向用户呈现页面的内容。defer 的特性是并行下载，延迟执行，能够更快的呈现页面。defer 和 async 的区别见：<a href="/Front-end-interview/html.html#defer-和-async-的区别">defer-和-async-的区别</a></li></ol> <h2 id="使用缓存"><a href="#使用缓存" class="header-anchor">#</a> 使用缓存</h2> <ol><li>index.html 使用协商缓存<br>
我们项目每次打包后 index 页面名称都是不变的，所以要使用协商缓存每次去服务器效验是否需要更新。</li> <li>静态资源使用 contenthash 做文件名称，并使用强缓存<br>
静态资源往往不太容易改变，webpack 在打包时我们使用 contenthash 作为文件名称后，一旦内容改变了，文件名称也就改变了，强缓存也就失效了，所以理论上静态资源的强缓存时间可以很大。</li> <li>动静分离，减少缓存失效的次数<br>
使用 webpack 打包时可以使用 splitChunks 进行分包，例如将引入的库和业务代码分离，这样库文件的缓存就不容易失效了。</li></ol> <p>缓存相关的知识详见：<a href="/Front-end-interview/http.html#http-缓存">http-缓存</a></p> <h2 id="减少重绘和重排"><a href="#减少重绘和重排" class="header-anchor">#</a> 减少重绘和重排</h2> <ol><li>重绘<br>
当重新生成渲染树后，就要将渲染树每个节点绘制到屏幕，这个过程叫重绘。例如改变字体颜色，会导致重绘。</li> <li>重排<br>
当改变 DOM 元素位置或大小时，会导致浏览器重新生成渲染树，这个过程叫重排，重排一定会导致重绘。</li></ol> <p>重排和重绘这两个操作都是非常昂贵的，因为 JavaScript 引擎线程与 GUI 渲染线程是互斥，它们同时只能一个在工作。可以使用以下策略来减少重绘和重排：</p> <ul><li>用 JavaScript 修改样式时，最好不要直接写样式，而是替换 class 来改变样式。</li> <li>如果要对 DOM 元素执行一系列操作，可以将 DOM 元素脱离文档流，修改完成后，再将它带回文档。推荐使用隐藏元素（display:none）或文档碎片（DocumentFragment），都能很好的实现这个方案。</li> <li>如果要插入大量 DOM 不要循环插入，使用文档碎片（DocumentFragment）包裹只插入一次。</li> <li>JS 获取 Layout 属性值（如：offsetLeft、scrollTop、getComputedStyle 等）会引起重排，因此不要在循环中反复获取值，而是使用缓存，例如：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i ＜ childs<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> <span class="token number">1</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  childs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> node<span class="token punctuation">.</span>offsetWidth <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>优化后：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> width <span class="token operator">=</span> node<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i ＜ childs<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> <span class="token number">1</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  childs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>对于不使用的页面，使用 display: none 隐藏，使其不参与 Layout Tree 的计算，节省 render 时间，见：<a href="https://github.com/NameWjp/blog/issues/101" target="_blank" rel="noopener noreferrer">display: none 对 浏览器 Layout Tree 的影响<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="使用事件委托"><a href="#使用事件委托" class="header-anchor">#</a> 使用事件委托</h2> <p>事件委托利用了事件冒泡，只指定一个事件处理程序，就可以管理某一类型的所有事件。不过现在各类框架已经解决了这个问题，详见：<a href="/Front-end-interview/js.html#什么是事件委托">什么是事件委托</a></p> <h2 id="大量计算使用-web-workers"><a href="#大量计算使用-web-workers" class="header-anchor">#</a> 大量计算使用 Web Workers</h2> <p>Web Worker 使用其他工作线程从而独立于主线程之外，它可以执行任务而不干扰用户界面。一个 worker 可以将消息发送到创建它的 JavaScript 代码, 通过将消息发送到该代码指定的事件处理程序（反之亦然）。Web Worker 适用于那些处理纯数据，或者与浏览器 UI 无关的长时间运行脚本。</p> <h2 id="dns-prefetch-和-preconnect"><a href="#dns-prefetch-和-preconnect" class="header-anchor">#</a> DNS-prefetch 和 Preconnect</h2> <p>当浏览器打开跨域外链（跳转到别的网页）的时候必须先将该域名解析为 IP 地址，然后浏览器才能发出请求。此过程称为 DNS 解析，<a href="https://developer.mozilla.org/zh-CN/docs/Web/Performance/dns-prefetch" target="_blank" rel="noopener noreferrer">DNS-prefetch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (DNS 预获取) 是尝试在请求资源之前解析域名，之后打开可以加快网页的加载速度，注意 dns-prefetch 仅对跨域域上的 DNS 查找有效，非跨域在打开网页的时候就已经解析过了，不需要多此一举，使用方式如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.gstatic.com/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>考虑将 dns-prefetch 与 preconnect（预连接）提示配对。尽管 dns-prefetch 仅执行 DNS 查找，但 preconnect 会建立与服务器的连接。如果站点是通过 HTTPS 服务的，则此过程包括 DNS 解析，建立 TCP 连接以及执行 TLS 握手，将两者结合起来可提供进一步减少跨域请求的感知延迟的机会，如下所示：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.gstatic.com/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.gstatic.com/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一些资源，如字体，以匿名模式加载。在这种情况下，使用 preconnect 应该设置 crossorigin 属性。如果您省略它，浏览器将只执行DNS查找。</p> <h2 id="preload-和-prefetch"><a href="#preload-和-prefetch" class="header-anchor">#</a> preload 和 prefetch</h2> <h3 id="preload"><a href="#preload" class="header-anchor">#</a> preload</h3> <p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/rel/preload" target="_blank" rel="noopener noreferrer">preload<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是 <code>&lt;link&gt;</code> 标签 <code>rel</code> 属性的属性值，同时需要配合 <code>as</code> 属性使用。</p> <p><code>as</code> 指定将要预加载的内容的类型，使得浏览器能够：</p> <ol><li>更精确地优化资源加载优先级。</li> <li>匹配未来的加载需求，在适当的情况下，重复利用同一资源。</li> <li>为资源应用正确的内容安全策略。</li> <li>为资源设置正确的 Accept 请求头。</li></ol> <p>看一下这个示例：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/vue/dist/vue.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这种做法将把 <code>&lt;link&gt;</code> 标签塞入一个预加载器中。这个预加载器在不阻塞页面 onload 事件的情况下，去加载资源。我们可以通过以下两个示例来作一个对比：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/vue/dist/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/echarts/2.1.10/chart/bar.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui/lib/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui/lib/theme-chalk/index.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">)</span> <span class="token comment">// load: 1449.759033203125ms</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面这个示例从加载到触发 onload 事件需要大概 1400 ms 的时间。再看一下使用 preload 预加载的时间：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/vue/dist/vue.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/echarts/2.1.10/chart/bar.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui/lib/index.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui/lib/theme-chalk/index.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

window.onload = () =&gt; {
  console.timeEnd('load') // load: 10.8818359375ms
}
</code></pre></div><p>用 preload 来加载资源，只需要 10 ms 就触发了 onload 事件，说明同样是下载文件，使用 preload 不会阻塞 onload 事件。注意这样加载的话无法在 onload 中使用这些文件提供的方法，适合加载一些无关紧要的文件。</p> <h3 id="prefetch"><a href="#prefetch" class="header-anchor">#</a> prefetch</h3> <p><a href="https://web.dev/i18n/en/link-prefetch/" target="_blank" rel="noopener noreferrer">prefetch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <code>preload</code> 不同，使用 <code>prefetch</code> 属性指定的资源将在浏览器空闲时间下下载，使用方式如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/articles/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>document<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>该 as 属性帮助浏览器设置正确的标头，并确定资源是否已在缓存中。此属性的示例值包括：document、script、style、font、image 等。</p> <h3 id="区别"><a href="#区别" class="header-anchor">#</a> 区别</h3> <ul><li>preload 是告诉浏览器页面必定需要的资源，浏览器一定会加载这些资源。</li> <li>prefetch 是告诉浏览器页面可能需要的资源，浏览器不一定会加载这些资源。</li> <li>对于当前页面很有必要的资源使用 preload，对于可能在将来的页面中使用的资源使用 prefetch。</li></ul> <h2 id="开启-gzip-压缩"><a href="#开启-gzip-压缩" class="header-anchor">#</a> 开启 gzip 压缩</h2> <p>gzip 是网站压缩加速的一种技术，对于开启后可以加快我们网站的打开速度，原理是经过服务器压缩，客户端浏览器快速解压的原理，可以大大减少了网站的流量。nginx 开启 gzip 配置如下：</p> <div class="language- extra-class"><pre class="language-text"><code>server{
  gzip on; # 是否开启gzip
  gzip_buffers 32 4K; # 用于处理请求压缩的缓冲区数量和大小
  gzip_comp_level 6; # 推荐6 压缩级别(级别越高,压的越小,越浪费CPU计算资源)
  gzip_min_length 1k; # 开始压缩的最小长度(再小就不要压缩了,意义不在)
  gzip_types application/javascript text/css text/xml; # 对哪些类型的文件用压缩 如txt,xml,html ,css
  gzip_disable &quot;MSIE [1-6]\.&quot;; #正则匹配UA，配置禁用gzip条件。此处表示ie6及以下不启用gzip（因为ie低版本不支持）
  gzip_http_version 1.1; # 开始压缩的http协议版本(可以不设置,目前几乎全是1.1协议)
  gzip_vary on; # 是否传输gzip压缩标志
}
</code></pre></div><h2 id="vue-优化"><a href="#vue-优化" class="header-anchor">#</a> Vue 优化</h2> <h3 id="合理拆分组件"><a href="#合理拆分组件" class="header-anchor">#</a> 合理拆分组件</h3> <p>在某些业务场景中，我们需要渲染很多 input 输入框，如果写法不对，则会导致性能问题，例如：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(data, index) in tableData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key in keys<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 20%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span>
          <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data[key]<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>v =&gt; handleInputChange(index, key, v)<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里渲染了很多的 input，在每个 input 输入时，修改 data 数据源来更新数据。这样写看似没有什么问题，其实当 data 的数据量大的时候会出现性能问题，因为这里的组件粒度太大了，每个 input 输入后，都会全量出发这个组件的 diff，所以我们可以换个写法：</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// 父组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(data, index) in tableData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:handle-input-change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(key, v) =&gt; handleInputChange(index, key, v)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:keys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>keys<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

// 子组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key in keys<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 20%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span>
        <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data[key]<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>v =&gt; handleInputChange(key, v)<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里我们只是简单的将代码抽出去独立成一份组件，却会带来巨大的性能提升。无论 data 数据量有多大，input 输入变化时，都只会进行一个 Child 组件的 diff。实际效果可以参考：<a href="https://github.com/NameWjp/vue-element-admin/blob/master/src/views/demo/index.vue" target="_blank" rel="noopener noreferrer">https://github.com/NameWjp/vue-element-admin/blob/master/src/views/demo/index.vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>参考链接:  <a href="https://github.com/NameWjp/blog/issues/123" target="_blank" rel="noopener noreferrer">Vue中合理拆分组件对性能的影响<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="react-优化"><a href="#react-优化" class="header-anchor">#</a> React 优化</h2> <h3 id="react-memo"><a href="#react-memo" class="header-anchor">#</a> React.memo</h3> <p>类似的还有类组件的 PureComponent、ShouldComponentUpdate，它们都是通过浅比较来跳过更新。当然，memo并不是免费的，不然 React 为什么不直接默认给所有组件都包裹一下，shallowEqual 会去挨个遍历 props 并进行比较，这个成本可要比默认的全等策略大多了。</p> <h3 id="usememo、usecallback-等缓存策略"><a href="#usememo、usecallback-等缓存策略" class="header-anchor">#</a> useMemo、useCallback 等缓存策略</h3> <p>使用 useMemo、useCallback 主要有以下两个场景</p> <ol><li>避免耗时的逻辑重复计算
只在某个状态变化才计算可以避免一些耗时的重复计算。</li> <li>防止子组件的缓存击穿
如果子组件使用 useMemo 包裹了，但是传递的 props 中的某个属性每次都是一个新对象，就会照成缓存无效，使用 useMemo 包裹可以解决这个问题。</li></ol> <h3 id="状态下放"><a href="#状态下放" class="header-anchor">#</a> 状态下放</h3> <p>例如以下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token constant">I</span> am child<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>update<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以看到 App 组件更新的原因是内部的 count 发生了变化，而 Child 虽然跟 count 没有任何关系，但是由于同属于一个组件，也被带着重新渲染了。我们稍微改造一下，把count及其相关的逻辑抽离到另外一个子组件Counter中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token constant">I</span> am child<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>update<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际测试一下上面的代码，虽然只是简单调整了一下组件结构，Child 居然不再重新渲染了。原因就在于变化的内容现在在 Counter 内部，App 组件会由于满足了默认的性能优化策略不再重新渲染，因此传递给 Child 的 props 就不会发生变化，从而 Child 也就满足了默认的性能优化策略，这种逻辑是具有传递性的，即如果 Child 还有子组件，也会因为 Child 没有重渲染，继续满足默认性能优化策略而都被跳过。所以在平时的开发中，建议要避免大组件，将组件的粒度控制要尽可能的细。</p> <h3 id="内容提升"><a href="#内容提升" class="header-anchor">#</a> 内容提升</h3> <p>比如以下例子，状态下放的方法就不适应了，因为 Child 的外层 div 中也用到了count：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token constant">I</span> am child<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div classname<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>update<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这时候就可以用另外一种方法：内容提升。简而言之就是将 Child 以 children 的方式进行传递，从而将不变的内容提取到 App 中，这样 Counter 更新不会影响到 Child：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token constant">I</span> am child<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div classname<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>update<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Counter<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Counter<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Child 现在是作为 Counter 组件的 props，props 的内容是在 App 组件中传递的，因此可以理解成 Child 依然是直接依赖于 App 组件，由于 App 没有重新渲染，因此 Child 也满足了默认的性能优化策略。</p> <h3 id="usereducer-加-usecontext-组合"><a href="#usereducer-加-usecontext-组合" class="header-anchor">#</a> useReducer 加 useContext 组合</h3> <p>使用 useReducer 加 useContext 组合可以避免某些场景的重渲染，例如：顶层和最底层的组件都使用了一个状态，每次顶层改变这个状态时，都会重新渲染整颗树，这个时候可以使用下面的办法来避免重渲染：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useReducer<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个上下文</span>
<span class="token keyword">const</span> StateContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义reducer函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个包装组件，它将状态逻辑封装在内部</span>
<span class="token keyword">const</span> <span class="token function-variable function">StateProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">StateContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">StateContext.Provider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 使用上下文的组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>StateContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      Count: </span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'decrement'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 子组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">I am child</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 应用程序组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">StateProvider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">StateProvider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>这里首先通过状态下放，将状态抽离到外部，防止整颗树渲染。之后利用内容提升，将其余子元素通过 children 传递给 StateProvider 组件。这样可以达到顶层和底层组件共享一个状态，状态变化时只更新这两个组件，不会导致整颗树重新渲染。</p> <h3 id="使用社区的轮子"><a href="#使用社区的轮子" class="header-anchor">#</a> 使用社区的轮子</h3> <p>例如：<a href="https://github.com/dai-shi/use-context-selector" target="_blank" rel="noopener noreferrer">use-context-selector<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/pmndrs/jotai" target="_blank" rel="noopener noreferrer">jotai<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/dai-shi/react-tracked" target="_blank" rel="noopener noreferrer">react-tracked<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="hybrid-app-下的性能优化"><a href="#hybrid-app-下的性能优化" class="header-anchor">#</a> Hybrid App 下的性能优化</h2> <ol><li>WebView 启动优化<br>
在 App 启动的时候生成一个 WebView 并让其全局化。或者更彻底一点，把 WebView 的实例保存在一个公共的池中，当用户访问这个 WebView 时，直接从公共池取出来加载网页，而不是重新初始化一个新的 WebView。</li> <li>离线包<br>
离线包就是将 HTML、JavaScript、CSS 等页面内静态资源打包到一个压缩包内，App 预先内置该压缩包到本地，然后当用户在客户端打开 H5 页面时，直接从本地加载。</li></ol> <h2 id="首屏渲染白屏时间如何优化"><a href="#首屏渲染白屏时间如何优化" class="header-anchor">#</a> 首屏渲染白屏时间如何优化</h2> <h3 id="如何分析首屏加载csr的性能"><a href="#如何分析首屏加载csr的性能" class="header-anchor">#</a> 如何分析首屏加载CSR的性能？</h3> <p>有以下几种方法进行分析：</p> <ol><li>network（浏览器-&gt;DevTools）</li> <li>performance （浏览器-&gt;DevTools）</li> <li>lighthouse（浏览器-&gt;DevTools）</li> <li>sentry（第三方平台）</li> <li><a href="https://webpagetest.org/" target="_blank" rel="noopener noreferrer"><strong>webPageTest</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 更全面，更详细，更强大的页面分析
具体怎么操作我就不赘述了，各位自行去看。</li></ol> <h3 id="分析后如何找出csr性能瓶颈"><a href="#分析后如何找出csr性能瓶颈" class="header-anchor">#</a> 分析后如何找出CSR性能瓶颈？</h3> <p>找出上面分析出对性能影响最大的点，从这个点着手优化。</p> <h3 id="如何解决csr性能瓶颈-从csr方向来讲的话-基本就两个方向了"><a href="#如何解决csr性能瓶颈-从csr方向来讲的话-基本就两个方向了" class="header-anchor">#</a> 如何解决CSR性能瓶颈？ 从CSR方向来讲的话，基本就两个方向了</h3> <ol><li><strong>网络层面</strong>：
从网络方面来讲，就是减少HTTP请求的次数，以及减小请求体积，这里就简单聊几点
a). 将多次请求合并到一次请求（ajax、精灵图，文件合并等）
b). 页面懒加载应该也可以算在这个方面。
c). 缓存住一些不经常改动的文件或内容将请求拦截（service worker）
b). 文件内容压缩
e). 静态资源CDN也是方式之一
f). 升级到 http2</li> <li><strong>渲染层面</strong>
a). 骨架屏，起码能让用户有打开了网页的感觉
b). 图片懒加载
c). 防抖节流
d). 代码层面的改善吧，很有可能是某些坏代码产生的</li></ol> <h3 id="有没有其他渲染方案可以解决csr当前问题-他的原理是什么"><a href="#有没有其他渲染方案可以解决csr当前问题-他的原理是什么" class="header-anchor">#</a> 有没有其他渲染方案可以解决CSR当前问题，他的原理是什么？</h3> <p>SSR。就是将框架代码提前在服务端跑一遍，不过一般除非对SEO要求比较高或者你们公司比较有钱，否则不太会去使用，因为比较占用服务器的资源。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Front-end-interview/safe.html" class="prev">
        前端安全
      </a></span> <span class="next"><a href="/Front-end-interview/other.html">
        其他
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Front-end-interview/assets/js/app.fdae9a04.js" defer></script><script src="/Front-end-interview/assets/js/2.2ef4b7ab.js" defer></script><script src="/Front-end-interview/assets/js/12.8bc73bd9.js" defer></script>
  </body>
</html>
